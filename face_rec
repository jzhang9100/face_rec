import cv2
import numpy as np


class face_fun:
    def __init__(self, dir):
        self.dir = dir  # dir where videos will be saved
        self.vidCap = cv2.VideoCapture(0)  # video capturer
    
    def get_face_data(self):
        #gathers face imgs from computer camera
        i = 0
        if self.vidCap.isOpened():  # try to get the first frame
            retval, frame = self.vidCap.read()
            while retval:
                cv2.imshow("Gather Facial Images", frame)
                retval, frame = self.vidCap.read()
                if (i % 2 == 0):
                    cv2.imwrite(self.dir + 'my_face' + str(i // 2) + '.jpg', frame)
                i += 1
    
                key = cv2.waitKey(20)
                if key == 27:  # exit on ESC
                    break
            self.vidCap.release()
            cv2.destroyAllWindows()
   
   
    def detect_face(self):
        # create window and puts box arond face
        cv2.namedWindow("Found yo Face")
        i = 0
        if self.vidCap.isOpened():  # try to get the first frame
            retval, frame = self.vidCap.read()
            while retval:
                frame = self.process_frame(frame)
                cv2.imshow("Face", frame)
                retval, frame = self.vidCap.read()
                key = cv2.waitKey(20)
                if key == 27:  # exit on ESC
                    break
            self.vidCap.release()
            cv2.destroyAllWindows()

    def process_frame(self, img):
        #use openCv's Haar-cascade detection
        face_cascade = cv2.CascadeClassifier('D:\\MAS\\Python\\Lib\\site-packages\\cv2\\data\\haarcascade_frontalface_default.xml')
        gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)
        f = face_cascade.detectMultiScale(gray, 1.3, 5)

        #draw rectangle around detected face
        for (x,y,w,h) in f:
            cv2.rectangle(img, (x, y), (x + w, y + h), (255, 0, 0), 2)

        return img
